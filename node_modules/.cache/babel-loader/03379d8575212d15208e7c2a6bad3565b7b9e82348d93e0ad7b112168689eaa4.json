{"ast":null,"code":"import * as React from 'react';\nimport { useRef, useEffect } from 'react';\nimport * as THREE from 'three';\nimport { useThree } from '@react-three/fiber';\nimport { suspend } from 'suspend-react';\nimport { Events } from 'hls.js';\nvar _window$document, _window$navigator;\nconst IS_BROWSER = typeof window !== 'undefined' && typeof ((_window$document = window.document) == null ? void 0 : _window$document.createElement) === 'function' && typeof ((_window$navigator = window.navigator) == null ? void 0 : _window$navigator.userAgent) === 'string';\nlet _HLSModule = null;\nasync function getHls() {\n  var _HLSModule2;\n  (_HLSModule2 = _HLSModule) !== null && _HLSModule2 !== void 0 ? _HLSModule2 : _HLSModule = await import('hls.js'); // singleton\n  const Ctor = _HLSModule.default;\n  if (Ctor.isSupported()) {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    return new Ctor(...args);\n  }\n  return null;\n}\nfunction useVideoTexture(srcOrSrcObject) {\n  let {\n    unsuspend = 'loadedmetadata',\n    start = true,\n    hls: hlsConfig = {},\n    crossOrigin = 'anonymous',\n    muted = true,\n    loop = true,\n    playsInline = true,\n    ...videoProps\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const gl = useThree(state => state.gl);\n  const hlsRef = useRef(null);\n  const texture = suspend(() => new Promise(async res => {\n    let src = undefined;\n    let srcObject = undefined;\n    if (typeof srcOrSrcObject === 'string') {\n      src = srcOrSrcObject;\n    } else {\n      srcObject = srcOrSrcObject;\n    }\n    const video = Object.assign(document.createElement('video'), {\n      src,\n      srcObject,\n      crossOrigin,\n      loop,\n      muted,\n      playsInline,\n      ...videoProps\n    });\n\n    // hlsjs extension\n    if (src && IS_BROWSER && src.endsWith('.m3u8')) {\n      const hls = hlsRef.current = await getHls(hlsConfig);\n      if (hls) {\n        hls.on(Events.MEDIA_ATTACHED, () => void hls.loadSource(src));\n        hls.attachMedia(video);\n      }\n    }\n    const texture = new THREE.VideoTexture(video);\n    if ('colorSpace' in texture) texture.colorSpace = gl.outputColorSpace;else texture.encoding = gl.outputEncoding;\n    video.addEventListener(unsuspend, () => res(texture));\n  }), [srcOrSrcObject]);\n  useEffect(() => {\n    start && texture.image.play();\n    return () => {\n      if (hlsRef.current) {\n        hlsRef.current.destroy();\n        hlsRef.current = null;\n      }\n    };\n  }, [texture, start]);\n  return texture;\n}\n\n//\n\nconst VideoTexture = _ref => {\n  let {\n    children,\n    src,\n    ...config\n  } = _ref;\n  const ret = useVideoTexture(src, config);\n  useEffect(() => {\n    return () => void ret.dispose();\n  }, [ret]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, children == null ? void 0 : children(ret));\n};\nexport { VideoTexture, useVideoTexture };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}